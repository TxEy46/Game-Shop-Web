<mat-toolbar class="toolbar">
  <div class="toolbar-left">
    <span>🎮 Game Shop</span>
  </div>

  <div class="toolbar-center" *ngIf="showSearch">
    <div class="search-container">
      <input type="text" placeholder="Search games..." [(ngModel)]="query" (input)="onSearch()">
      <div class="search-results" *ngIf="results.length">
        <div class="search-item" *ngFor="let game of results" (click)="goToGameDetail(game.id)">
          <img [src]="game.image_url" alt="{{ game.name }}">
          <span>{{ game.name }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="toolbar-right" *ngIf="user">
    <!-- Cart -->
    <div class="cart-container" [matMenuTriggerFor]="cartMenu">
      🛒 <span class="cart-count">{{ getCartCount() }}</span>
    </div>

    <!-- Wallet + Username -->
    <div class="wallet" [matMenuTriggerFor]="userMenu">
      <img *ngIf="user" class="profile-pic" [src]="getAvatarUrl()" alt="Profile">
      <span class="balance">{{ user.wallet_balance | number:'1.2-2' }} บาท</span>
      <!-- ลบ username ออกเพราะไม่มีใน template เดิม -->
    </div>
  </div>
</mat-toolbar>

<!-- Cart Menu -->
<mat-menu #cartMenu="matMenu">
  <ng-container *ngIf="cart.length; else emptyCart">
    <div *ngFor="let item of cart" class="cart-item">
      <img [src]="item.image_url" alt="{{ item.name }}">
      <span>{{ item.name }} x{{ item.quantity }}</span>
      <span>{{ (item.price * item.quantity) | number:'1.2-2' }} บาท</span>
      <button (click)="removeFromCart(item.gameId)">ลบ</button>
    </div>
    <div class="cart-total">รวม: {{ getCartTotal() | number:'1.2-2' }} บาท</div>
    <button (click)="goToCheckout()">ไปชำระเงิน</button>
  </ng-container>
  <ng-template #emptyCart>
    <div>ตะกร้าว่าง</div>
  </ng-template>
</mat-menu>

<!-- User Menu -->
<mat-menu #userMenu="matMenu">
  <button mat-menu-item (click)="goToHome()">🏠 หน้าหลัก</button>
  <button mat-menu-item (click)="goToProfile()">👤 โปรไฟล์</button>
  <button mat-menu-item (click)="goToWallet()">💰 กระเป๋าเงิน</button>
  <button mat-menu-item (click)="goToLibrary()">🎮 คลังเกม</button>
  <button mat-menu-item (click)="logout()">🚪 ออกจากระบบ</button>
</mat-menu>